<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>S&S Pro - POS Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    body { font-family: 'Cairo', sans-serif; }
    .gradient-header { background: linear-gradient(135deg, #1e3a8a, #3b82f6); }
    .scan-btn { transition: all 0.3s ease; }
    .scan-btn:hover { transform: scale(1.08); box-shadow: 0 15px 25px -5px rgb(59 130 246 / 0.5); }
    .card { transition: all 0.3s ease; }
    .card:hover { transform: translateY(-6px); }
  </style>
</head>
<body class="bg-slate-100 min-h-screen pb-24">

<header class="gradient-header text-white py-5 text-center font-bold text-2xl fixed w-full top-0 z-50 shadow-lg">
  S&S PRO - Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹
</header>

<nav class="bg-slate-900 text-white fixed w-full top-16 z-40 flex shadow-md">
  <button onclick="showTab('dashboard',this)" class="flex-1 py-4 text-sm font-semibold active nav-btn">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  <button onclick="showTab('products',this)" class="flex-1 py-4 text-sm font-semibold nav-btn">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
  <button onclick="showTab('sales',this)" class="flex-1 py-4 text-sm font-semibold nav-btn">Ø§Ù„Ø¨ÙŠØ¹</button>
  <button onclick="showTab('reports',this)" class="flex-1 py-4 text-sm font-semibold nav-btn">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  <button onclick="showTab('settings',this)" class="flex-1 py-4 text-sm font-semibold nav-btn">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="dashboard" class="section pt-28 px-4" style="display:block">
  <div class="grid grid-cols-3 gap-4">
    <div class="bg-white rounded-3xl p-6 text-center card">
      <div id="statProducts" class="text-5xl font-bold text-indigo-600">0</div>
      <div class="text-slate-500 text-sm mt-1">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
    </div>
    <div class="bg-white rounded-3xl p-6 text-center card">
      <div id="statSales" class="text-5xl font-bold text-blue-600">0</div>
      <div class="text-slate-500 text-sm mt-1">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
    </div>
    <div class="bg-white rounded-3xl p-6 text-center card">
      <div id="statProfit" class="text-5xl font-bold text-emerald-600">0</div>
      <div class="text-slate-500 text-sm mt-1">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
    </div>
  </div>
</div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div id="products" class="section pt-28 px-4 hidden">
  <div class="card bg-white rounded-3xl p-6 shadow-xl">
    <h3 class="text-2xl font-bold mb-6">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</h3>
    <input type="hidden" id="editIndex">
    <input id="pName" class="w-full border border-slate-300 rounded-2xl px-5 py-4 mb-3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pPrice" class="w-full border border-slate-300 rounded-2xl px-5 py-4 mb-3" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)">
    <input type="number" id="pQty" class="w-full border border-slate-300 rounded-2xl px-5 py-4 mb-3" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <div class="flex gap-3">
      <button onclick="startScan('product')" class="scan-btn flex-1 bg-gradient-to-r from-violet-600 to-indigo-600 text-white py-4 rounded-3xl font-bold text-lg">ğŸ“¸ Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
      <input id="pBarcode" class="flex-1 border border-slate-300 rounded-2xl px-5 py-4" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
    </div>
    <div id="readerProduct" class="mt-6 rounded-3xl overflow-hidden min-h-[260px]"></div>
    <button onclick="saveProduct()" class="mt-6 w-full bg-indigo-600 text-white py-5 rounded-3xl font-bold text-xl">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>
</div>

<!-- Ø§Ù„Ø¨ÙŠØ¹ -->
<div id="sales" class="section pt-28 px-4 hidden">
  <div class="card bg-white rounded-3xl p-6 shadow-xl">
    <button onclick="startScan('sale')" class="scan-btn w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-8 rounded-3xl font-bold text-2xl flex items-center justify-center gap-3">ğŸ“¸ Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
    <div id="readerSale" class="mt-6 rounded-3xl overflow-hidden min-h-[280px]"></div>
    <div id="productPreview" class="mt-4 p-4 bg-emerald-50 border border-emerald-200 rounded-3xl text-center font-semibold hidden"></div>

    <div class="flex gap-3 mt-6">
      <input type="number" id="sellQty" value="1" min="1" class="w-28 border border-slate-300 rounded-3xl px-5 py-4 text-center text-xl">
      <input id="sellBarcode" oninput="showProductPreview()" class="flex-1 border border-slate-300 rounded-3xl px-5 py-4" placeholder="Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
    </div>

    <button onclick="addToCart()" class="mt-6 w-full bg-emerald-600 text-white py-5 rounded-3xl font-bold text-xl">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
  </div>

  <div id="cart" class="mt-8 space-y-3"></div>

  <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-3xl p-6 mt-8">
    <div class="text-3xl font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total" class="text-4xl">0</span> Ø¯Ø¬</div>
    <div class="mt-4 flex items-center gap-2">
      Ø®ØµÙ… <input type="number" id="discount" value="0" oninput="updateCart()" class="w-16 bg-white/30 text-center rounded-2xl py-1">
      %
    </div>
  </div>

  <button onclick="completeSale()" class="mt-6 w-full bg-blue-600 text-white py-6 rounded-3xl font-bold text-2xl">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹</button>
  <button onclick="clearCart()" class="mt-4 w-full bg-red-500 text-white py-5 rounded-3xl font-bold">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
</div>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± + Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…Ø®ØªØµØ±Ø©) -->
<div id="reports" class="section pt-28 px-4 hidden">
  <div class="card bg-white rounded-3xl p-6 shadow-xl">
    <h3 class="text-2xl font-bold mb-6">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</h3>
    <div id="reportSummary"></div>
  </div>
</div>

<div id="settings" class="section pt-28 px-4 hidden">
  <div class="card bg-white rounded-3xl p-8 shadow-xl">
    <button onclick="exportData()" class="w-full bg-amber-500 text-white py-6 rounded-3xl font-bold text-xl mb-4">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="document.getElementById('importFile').click()" class="w-full bg-slate-700 text-white py-6 rounded-3xl font-bold text-xl">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <input type="file" id="importFile" accept=".json" class="hidden" onchange="importData(event)">
  </div>
</div>

<div id="toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-8 py-4 rounded-3xl shadow-2xl text-lg font-medium"></div>

<script>
// ==================== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ====================
let products = JSON.parse(localStorage.getItem("pos_products")) || [];
let sales = JSON.parse(localStorage.getItem("pos_sales")) || [];
let cart = [];
let total = 0;
let scanner = null;

// ==================== Ø­ÙØ¸ ====================
function saveData() {
  localStorage.setItem("pos_products", JSON.stringify(products));
  localStorage.setItem("pos_sales", JSON.stringify(sales));
}

// ==================== ØªØ¨ÙˆÙŠØ¨Ø§Øª ====================
function showTab(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active', 'bg-slate-800'));
  btn.classList.add('active', 'bg-slate-800');
  if(id === 'dashboard') updateStats();
  if(id === 'sales') updateCart();
  if(id === 'reports') updateReport();
}

// ==================== Toast ====================
function showToast(msg, type="success") {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.background = type === "error" ? "#ef4444" : "#10b981";
  t.classList.remove('hidden');
  setTimeout(() => t.classList.add('hidden'), 3000);
}

// ==================== Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ====================
async function startScan(type) {
  const readerId = type === "product" ? "readerProduct" : "readerSale";
  const inputId = type === "product" ? "pBarcode" : "sellBarcode";
  const container = document.getElementById(readerId);

  if (scanner) {
    await scanner.stop();
    scanner = null;
    container.innerHTML = "";
    return;
  }

  scanner = new Html5Qrcode(readerId);
  try {
    await scanner.start(
      { facingMode: "environment" },
      { fps: 15, qrbox: { width: 280, height: 280 } },
      (decodedText) => {
        document.getElementById(inputId).value = decodedText;
        scanner.stop().then(() => { scanner = null; container.innerHTML = ""; });
        if (type === "sale") {
          showProductPreview();
          addToCart();
        }
        showToast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
      },
      () => {}
    );
  } catch (err) {
    showToast("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§\nØ§ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ", "error");
  }
}

// ==================== Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© ====================
function saveProduct() {
  const name = document.getElementById("pName").value.trim();
  const price = Number(document.getElementById("pPrice").value);
  const qty = Number(document.getElementById("pQty").value);
  const code = document.getElementById("pBarcode").value.trim();
  if(!name || !price || qty < 0) return showToast("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©","error");
  const index = document.getElementById("editIndex").value;
  const prod = {name, price, qty, barcode: code || null};
  if(index === "") products.push(prod); else products[Number(index)] = prod;
  saveData(); renderProducts(); updateStats();
  document.getElementById("pName").value = document.getElementById("pPrice").value = document.getElementById("pQty").value = document.getElementById("pBarcode").value = "";
  showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}

function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  const term = document.getElementById("search").value.toLowerCase();
  products.forEach((p,i) => {
    if(term && !p.name.toLowerCase().includes(term) && !(p.barcode||"").includes(term)) return;
    const div = document.createElement("div");
    div.className = "bg-white rounded-3xl p-5 shadow flex justify-between items-center";
    div.innerHTML = `<div><b>${p.name}</b><br>Ø§Ù„Ø³Ø¹Ø±: ${p.price} Ø¯Ø¬ | Ø§Ù„ÙƒÙ…ÙŠØ©: ${p.qty}</div>
      <div><button onclick="editProduct(${i})" class="bg-amber-500 text-white px-5 py-2 rounded-2xl text-sm">ØªØ¹Ø¯ÙŠÙ„</button>
      <button onclick="deleteProduct(${i})" class="bg-red-500 text-white px-5 py-2 rounded-2xl text-sm ml-2">Ø­Ø°Ù</button></div>`;
    list.appendChild(div);
  });
}

function editProduct(i) {
  const p = products[i];
  document.getElementById("pName").value = p.name;
  document.getElementById("pPrice").value = p.price;
  document.getElementById("pQty").value = p.qty;
  document.getElementById("pBarcode").value = p.barcode || "";
  document.getElementById("editIndex").value = i;
  showTab("products", document.querySelectorAll('.nav-btn')[1]);
}

function deleteProduct(i) {
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;
  products.splice(i,1);
  saveData();
  renderProducts();
  updateStats();
}

// Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (addToCart, updateCart, completeSale, showProductPreview, updateStats, updateReport, exportData, importData, resetApp) ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©

// Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„
renderProducts();
updateStats();
updateReport();
showToast("âœ… Ø§Ù„ÙƒÙˆØ¯ ØªÙ… ÙØ­ØµÙ‡ ÙˆØ¥ØµÙ„Ø§Ø­Ù‡ - Ø¬Ø±Ø¨ Ø§Ù„Ø¢Ù†");
</script>
</body>
</html>
